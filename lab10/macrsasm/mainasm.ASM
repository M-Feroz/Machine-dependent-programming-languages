.386
.model FLAT,C


PUSHR MACRO RG
	IRP REG, <RG>
	   IFIDN <REG>, <F>
	     PUSHF
	   ELSE
		 PUSH REG
	   ENDIF
	ENDM
ENDM   

POPR MACRO RG
   IRP REG, <RG>
	   IFIDN <REG>, <F>
	     POPF
	   ELSE
		 POP REG
	   ENDIF
	ENDM
ENDM 

PROLOG MACRO

	PUSH EBP
	MOV EBP,ESP

	MOV ESI, DWORD PTR[EBP+8]
	MOV ECX, DWORD PTR[EBP+12]
	MOV EDI, DWORD PTR[EBP+16]

	PUSHR <EDI, ESI, F>

ENDM

EPILOG MACRO

	POPR <F, ESI, EDI, EBP>

ENDM

PUBLIC Copy

.CODE
Copy PROC
  PROLOG

  CLD
  CMP ESI, EDI
  JA M1
  JE KON
  MOV EAX, ECX
  SHL EAX, 2
  ADD ESI, EAX
  ADD EDI, EAX
  STD

M1:
  REP MOVSD


KON:
  EPILOG
  RET

Copy ENDP
END
